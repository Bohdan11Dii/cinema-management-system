{% load widget_tweaks %}

<div id="formset-container">
  {{ contact_formset.management_form }}

  {% for form in contact_formset %}
    <div class="contact-form card shadow-sm mb-3 position-relative p-3">
      {{ form.id }} {# hidden поле для існуючої форми #}
      {{ form.DELETE|add_class:"d-none" }} {# checkbox hidden, можна не показувати #}
      <button type="button" class="remove-form close-btn" title="Remove">
        <i class="bx bx-x"></i>
      </button>

      <div class="row">
        {% for field in form.visible_fields %}
          {% if field.name != 'DELETE' and field.name != 'id' %}
            <div class="col-md-6 mb-2">
              <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>


              {% if field.name == 'logo' and field.value %}
                <div class="mb-2">
                  <img src="{{ field.value.url }}" alt="Current logo" style="max-height:100px;">
                </div>
              {% endif %}

              {{ field|add_class:"form-control" }}

              {% if field.errors %}
                <div class="text-danger small">{{ field.errors }}</div>
              {% endif %}
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  {% endfor %}
</div>

{# Hidden prototype for JS #}
<div id="empty-form" class="d-none">
  <div class="contact-form card shadow-sm mb-3 position-relative p-3">
    {{ contact_formset.empty_form.id }}
    {{ contact_formset.empty_form.DELETE|add_class:"d-none" }} {# checkbox hidden, можна не показувати #}
    <button type="button" class="remove-form close-btn" title="Remove">
      <i class="bx bx-x"></i>
    </button>

    <div class="row">
      {% for field in contact_formset.empty_form.visible_fields %}
        {% if field.name != 'DELETE' and field.name != 'id' %}
          <div class="col-md-6 mb-2">
            <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
            {{ field|add_class:"form-control" }}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</div>

<button type="button" id="add-contact" class="btn btn-outline-primary mt-2">➕ Додати контакт</button>

<style>
    .contact-form {
        border-radius: 12px;
        padding: 18px;
        background: #ffffff;
        transition: box-shadow .2s;
    }

    .contact-form:hover {
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
    }

    .close-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        border: none;
        background: transparent;
        color: #e55353;
        cursor: pointer;
        font-size: 1.1rem;
    }

    .close-btn:hover {
        color: #b02121;
    }

    .custom-toggle {
        position: relative;
        display: inline-block;
        width: 46px;
        height: 26px;
    }

    .custom-toggle input {
        display: none;
    }

    .custom-toggle .track {
        position: absolute;
        inset: 0;
        background: #ddd;
        border-radius: 26px;
        transition: .25s;
    }

    .custom-toggle .thumb {
        position: absolute;
        top: 3px;
        left: 3px;
        width: 20px;
        height: 20px;
        background: #fff;
        border-radius: 50%;
        transition: .25s;
        box-shadow: 0 1px 3px rgba(0, 0, 0, .2);
    }

    .custom-toggle input:checked + .track {
        background: #3C91E6;
    }

    .custom-toggle input:checked + .track .thumb {
        transform: translateX(20px);
    }
</style>
